# =============================================
# SENSIBILIDAD DEL TAMAÃ‘O MUESTRAL SEGÃšN E â€“ Gretl 2025b
# =============================================

# === 1. Simular base de datos sintÃ©tica ===
nulldata 500
series ingresos = normal(2000, 500)  # media â‰ˆ 2000, Ïƒ â‰ˆ 500

# === 2. Definir constantes globales ===
scalar Z = 1.96      # Confianza del 95%
scalar media = mean(ingresos)
scalar sigma = sd(ingresos)
scalar sigma2 = sigma^2
scalar N = $nobs

# === 3. Imprimir encabezado de sensibilidad ===
printf "\nðŸ“Š Sensibilidad del tamaÃ±o muestral frente al margen de error permitido (E)\n"
printf "--------------------------------------------------------------------------\n"
printf "  E     n_optimo    Margen      LÃ­mite inf   LÃ­mite sup\n"
printf "--------------------------------------------------------------------------\n"

# === 4. Bucle sobre distintos valores de E ===
scalar E = 5
loop while E <= 30
    scalar n_A1 = (Z^2 * sigma2) / E^2
    scalar n_A  = n_A1 / (1 + n_A1 / N)
    scalar n_B  = (N * Z^2 * sigma2) / (N * E^2 + Z^2 * sigma2)
    scalar n_C  = sigma2 / ((E / Z)^2 + (sigma2 / N))
    scalar n    = ceil(max(n_A, max(n_B, n_C)))

    scalar f       = n / N
    scalar margen  = Z * sigma / sqrt(n) * sqrt(1 - f)
    scalar inf     = media - margen
    scalar sup     = media + margen

    printf "%4.0f    %6.0f      %7.2f      %10.2f   %10.2f\n", E, n, margen, inf, sup

    E = E + 5
endloop

printf "\nâœ… AnÃ¡lisis completo â€“ Sensibilidad de n segÃºn E (con correcciÃ³n por poblaciÃ³n finita)\n"

# Fin del script
